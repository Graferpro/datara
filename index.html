<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>D√∂viz & Hesap Makinesi PRO</title>
<style>
  :root{
    --bg:#1a1a1a;
    --panel:#242424;
    --panel2:#2a2a2a;
    --text:#ffffff;
    --muted:rgba(255,255,255,.65);
    --key:#333333;
    --key2:#2f2f2f;
    --accent:#ff6b35;
    --accent2:#4ecdc4;
    --line:rgba(255,255,255,.08);
    --gradient1:#667eea;
    --gradient2:#764ba2;
    --success:#00d4aa;
    --warning:#ffd93d;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  
  body{
    font-family:'Segoe UI',system-ui,-apple-system,Roboto,Arial;
    background:linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    color:var(--text);
    min-height:100vh;
    overflow-x:hidden;
  }

  /* ==================== ANIMATED BACKGROUND ==================== */
  .bg-animated {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
  }
  .bg-animated .circle {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(102,126,234,0.15) 0%, transparent 70%);
    animation: float 20s infinite ease-in-out;
  }
  .bg-animated .circle:nth-child(1) {
    width: 300px;
    height: 300px;
    top: -150px;
    left: -100px;
    animation-delay: 0s;
  }
  .bg-animated .circle:nth-child(2) {
    width: 250px;
    height: 250px;
    bottom: -125px;
    right: -80px;
    animation-delay: 5s;
  }
  .bg-animated .circle:nth-child(3) {
    width: 200px;
    height: 200px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation-delay: 10s;
  }
  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(20px, -30px) scale(1.05); }
    50% { transform: translate(-20px, 20px) scale(0.95); }
    75% { transform: translate(30px, 10px) scale(1.02); }
  }

  /* ==================== TOP BAR ==================== */
  .topbar{
    position:relative;
    z-index:10;
    height:60px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 16px;
    background:rgba(36,36,36,0.9);
    backdrop-filter:blur(10px);
    border-bottom:1px solid var(--line);
    box-shadow:0 2px 10px rgba(0,0,0,0.3);
  }
  .topbar-left{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .back{
    width:38px;
    height:38px;
    border-radius:50%;
    display:grid;
    place-items:center;
    cursor:pointer;
    user-select:none;
    background:rgba(255,255,255,0.05);
    transition:all 0.3s ease;
    font-size:22px;
  }
  .back:hover{
    background:rgba(255,255,255,0.12);
    transform:scale(1.1);
  }
  .title{
    font-size:22px;
    font-weight:700;
    background:linear-gradient(135deg, var(--gradient1), var(--gradient2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
  }

  /* ==================== TAB NAVIGATION ==================== */
  .tabs{
    display:flex;
    gap:8px;
  }
  .tab{
    padding:8px 16px;
    border-radius:20px;
    background:rgba(255,255,255,0.05);
    cursor:pointer;
    font-size:14px;
    font-weight:600;
    transition:all 0.3s ease;
    user-select:none;
  }
  .tab:hover{
    background:rgba(255,255,255,0.1);
  }
  .tab.active{
    background:linear-gradient(135deg, var(--accent), var(--accent2));
    color:#fff;
    box-shadow:0 4px 15px rgba(255,107,53,0.3);
  }

  /* ==================== SCREEN CONTAINER ==================== */
  .screen{
    display:none;
    position:relative;
    z-index:5;
    animation:fadeIn 0.4s ease;
  }
  .screen.active{
    display:block;
  }
  @keyframes fadeIn {
    from{opacity:0;transform:translateY(10px);}
    to{opacity:1;transform:translateY(0);}
  }

  /* ==================== TUMBLER SCREEN ==================== */
  .tumbler-wrap{
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:20px;
  }
  .tumbler-box{
    background:var(--panel);
    border-radius:20px;
    padding:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.4);
    border:1px solid var(--line);
  }
  .tumbler-title{
    font-size:18px;
    font-weight:700;
    margin-bottom:16px;
    color:var(--accent2);
  }
  .tumbler-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
    gap:12px;
  }
  .tumbler-item{
    background:var(--panel2);
    border-radius:14px;
    padding:16px;
    text-align:center;
    border:2px solid transparent;
    transition:all 0.3s ease;
    cursor:pointer;
  }
  .tumbler-item:hover{
    border-color:var(--accent);
    transform:translateY(-3px);
    box-shadow:0 6px 20px rgba(255,107,53,0.2);
  }
  .tumbler-item.selected{
    border-color:var(--success);
    background:linear-gradient(135deg, rgba(0,212,170,0.15), rgba(78,205,196,0.15));
  }
  .tumbler-label{
    font-size:14px;
    color:var(--muted);
    margin-bottom:8px;
  }
  .tumbler-value{
    font-size:20px;
    font-weight:700;
    color:var(--text);
  }

  /* ==================== CALCULATOR SCREEN ==================== */
  .calc-wrap{
    min-height:calc(100vh - 60px);
    display:flex;
    flex-direction:column;
  }
  .display-area{
    background:var(--panel2);
    padding:24px 20px;
    border-bottom:1px solid var(--line);
  }
  .display{
    font-size:56px;
    font-weight:700;
    text-align:right;
    color:var(--text);
    letter-spacing:1px;
    min-height:70px;
    word-break:break-all;
    text-shadow:0 2px 10px rgba(255,107,53,0.3);
  }
  .sub-display{
    font-size:20px;
    color:var(--muted);
    text-align:right;
    margin-top:8px;
    min-height:24px;
  }

  .keypad{
    display:grid;
    grid-template-columns:repeat(4, 1fr);
    flex:1;
    gap:1px;
    background:var(--line);
    padding:1px;
  }
  .k{
    background:var(--key2);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    font-weight:600;
    user-select:none;
    cursor:pointer;
    min-height:80px;
    transition:all 0.2s ease;
    position:relative;
    overflow:hidden;
  }
  .k::before{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(255,255,255,0.1);
    transform:translate(-50%, -50%);
    transition:width 0.4s, height 0.4s;
  }
  .k:active::before{
    width:200px;
    height:200px;
  }
  .k.dark{
    background:var(--key);
    color:var(--accent2);
  }
  .k.op{
    background:linear-gradient(135deg, var(--accent), #ff8c61);
    color:#fff;
    font-weight:700;
  }
  .k.wide{
    grid-column:span 2;
  }

  /* ==================== CURRENCY SCREEN ==================== */
  .currency-wrap{
    min-height:calc(100vh - 60px);
    display:flex;
    flex-direction:column;
  }
  .searchWrap{
    padding:16px;
    background:var(--panel2);
    border-bottom:1px solid var(--line);
  }
  .search{
    width:100%;
    border:none;
    outline:none;
    padding:14px 18px;
    border-radius:16px;
    background:rgba(255,255,255,0.05);
    color:var(--text);
    font-size:16px;
    border:2px solid transparent;
    transition:all 0.3s ease;
  }
  .search:focus{
    border-color:var(--accent);
    background:rgba(255,255,255,0.08);
  }

  .pairBox{
    background:var(--panel2);
    padding:20px 18px;
    border-bottom:1px solid var(--line);
  }
  .pairRow{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 0;
  }
  .pairLeft{
    display:flex;
    align-items:center;
    gap:12px;
    font-size:20px;
    font-weight:700;
  }
  .flag{
    font-size:32px;
  }
  .bigNum{
    font-size:48px;
    font-weight:700;
    letter-spacing:1px;
    color:var(--success);
  }
  .divider{
    height:1px;
    background:linear-gradient(90deg, transparent, var(--accent), transparent);
    margin:8px 0;
  }

  .list{
    padding:8px 0 20px;
    overflow-y:auto;
  }
  .item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:16px 18px;
    border-bottom:1px solid var(--line);
    cursor:pointer;
    transition:all 0.3s ease;
    position:relative;
  }
  .item::before{
    content:'';
    position:absolute;
    left:0;
    top:0;
    width:4px;
    height:100%;
    background:var(--accent);
    transform:scaleY(0);
    transition:transform 0.3s ease;
  }
  .item:hover::before{
    transform:scaleY(1);
  }
  .item:hover{
    background:rgba(255,255,255,0.03);
  }
  .left{
    display:flex;
    align-items:center;
    gap:14px;
  }
  .name{
    font-size:17px;
    font-weight:500;
  }
  .code{
    font-size:16px;
    color:var(--muted);
    font-weight:700;
    letter-spacing:0.5px;
  }

  .bottomInfo{
    background:var(--panel2);
    border-top:1px solid var(--line);
    padding:12px 16px;
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:10px;
  }
  .stamp{
    color:var(--accent2);
    font-size:14px;
    font-weight:600;
    line-height:1.2;
  }
  .rateLine{
    color:var(--muted);
    font-size:14px;
    margin-top:6px;
  }

  /* ==================== CHART SCREEN ==================== */
  .chart-wrap{
    padding:20px;
  }
  .chart-box{
    background:var(--panel);
    border-radius:20px;
    padding:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.4);
    border:1px solid var(--line);
  }
  .chart-title{
    font-size:20px;
    font-weight:700;
    margin-bottom:20px;
    background:linear-gradient(135deg, var(--gradient1), var(--gradient2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
  }
  #chartCanvas{
    width:100%;
    height:300px;
  }
  .chart-legend{
    display:flex;
    justify-content:center;
    gap:20px;
    margin-top:20px;
    flex-wrap:wrap;
  }
  .legend-item{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:14px;
  }
  .legend-color{
    width:16px;
    height:16px;
    border-radius:4px;
  }

  /* ==================== RESPONSIVE ==================== */
  @media(max-width:480px){
    .tabs{flex-wrap:wrap;}
    .tab{font-size:12px;padding:6px 12px;}
    .display{font-size:42px;}
    .bigNum{font-size:36px;}
  }
</style>
</head>

<body>
  <!-- ANIMATED BACKGROUND -->
  <div class="bg-animated">
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
  </div>

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="topbar-left">
      <div class="back" id="backBtn" style="visibility:hidden;">‚Üê</div>
      <div class="title" id="topTitle">D√∂viz & Hesap Makinesi PRO</div>
    </div>
    <div class="tabs">
      <div class="tab active" data-tab="tumbler">T√ºmbler</div>
      <div class="tab" data-tab="calc">Hesap</div>
      <div class="tab" data-tab="currency">D√∂viz</div>
      <div class="tab" data-tab="chart">Grafik</div>
    </div>
  </div>

  <!-- TUMBLER SCREEN -->
  <div class="screen active" id="tumblerScreen">
    <div class="tumbler-wrap">
      <div class="tumbler-box">
        <div class="tumbler-title">üéØ Kategori Se√ßin</div>
        <div class="tumbler-grid">
          <div class="tumbler-item" data-category="borsa">
            <div class="tumbler-label">Kategori</div>
            <div class="tumbler-value">üìà Borsa</div>
          </div>
          <div class="tumbler-item" data-category="kripto">
            <div class="tumbler-label">Kategori</div>
            <div class="tumbler-value">‚Çø Kripto</div>
          </div>
          <div class="tumbler-item" data-category="doviz">
            <div class="tumbler-label">Kategori</div>
            <div class="tumbler-value">üí± D√∂viz</div>
          </div>
          <div class="tumbler-item" data-category="emtia">
            <div class="tumbler-label">Kategori</div>
            <div class="tumbler-value">ü•á Emtia</div>
          </div>
        </div>
      </div>

      <div class="tumbler-box">
        <div class="tumbler-title">‚ö° Zaman Aralƒ±ƒüƒ±</div>
        <div class="tumbler-grid">
          <div class="tumbler-item" data-time="1h">
            <div class="tumbler-label">S√ºre</div>
            <div class="tumbler-value">1 Saat</div>
          </div>
          <div class="tumbler-item" data-time="1d">
            <div class="tumbler-label">S√ºre</div>
            <div class="tumbler-value">1 G√ºn</div>
          </div>
          <div class="tumbler-item" data-time="1w">
            <div class="tumbler-label">S√ºre</div>
            <div class="tumbler-value">1 Hafta</div>
          </div>
          <div class="tumbler-item" data-time="1m">
            <div class="tumbler-label">S√ºre</div>
            <div class="tumbler-value">1 Ay</div>
          </div>
        </div>
      </div>

      <div class="tumbler-box">
        <div class="tumbler-title">üé® Grafik Tipi</div>
        <div class="tumbler-grid">
          <div class="tumbler-item" data-chart="line">
            <div class="tumbler-label">Tip</div>
            <div class="tumbler-value">üìä √áizgi</div>
          </div>
          <div class="tumbler-item" data-chart="bar">
            <div class="tumbler-label">Tip</div>
            <div class="tumbler-value">üìä Bar</div>
          </div>
          <div class="tumbler-item" data-chart="area">
            <div class="tumbler-label">Tip</div>
            <div class="tumbler-value">üìä Alan</div>
          </div>
          <div class="tumbler-item" data-chart="candle">
            <div class="tumbler-label">Tip</div>
            <div class="tumbler-value">üïØÔ∏è Mum</div>
          </div>
        </div>
      </div>

      <div class="tumbler-box" style="text-align:center;padding:32px;">
        <div style="font-size:18px;color:var(--muted);margin-bottom:16px;">
          Se√ßimleriniz:<br>
          <span id="tumblerSelection" style="color:var(--success);font-weight:700;">Kategori ‚Ä¢ Zaman ‚Ä¢ Grafik</span>
        </div>
        <button id="applyTumbler" style="background:linear-gradient(135deg, var(--accent), var(--accent2));border:none;color:#fff;padding:14px 32px;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(255,107,53,0.3);transition:all 0.3s ease;">
          üöÄ Uygula
        </button>
      </div>
    </div>
  </div>

  <!-- CALCULATOR SCREEN -->
  <div class="screen" id="calcScreen">
    <div class="calc-wrap">
      <div class="display-area">
        <div class="sub-display" id="subDisplay"></div>
        <div class="display" id="display">0</div>
      </div>

      <div class="keypad">
        <div class="k dark" data-action="clear">C</div>
        <div class="k dark" data-action="sign">+/-</div>
        <div class="k dark" data-action="percent">%</div>
        <div class="k op" data-op="√∑">√∑</div>

        <div class="k" data-key="7">7</div>
        <div class="k" data-key="8">8</div>
        <div class="k" data-key="9">9</div>
        <div class="k op" data-op="√ó">√ó</div>

        <div class="k" data-key="4">4</div>
        <div class="k" data-key="5">5</div>
        <div class="k" data-key="6">6</div>
        <div class="k op" data-op="‚àí">‚àí</div>

        <div class="k" data-key="1">1</div>
        <div class="k" data-key="2">2</div>
        <div class="k" data-key="3">3</div>
        <div class="k op" data-op="+">+</div>

        <div class="k wide" data-key="0">0</div>
        <div class="k" data-key=",">,</div>
        <div class="k op" data-op="=">=</div>
      </div>
    </div>
  </div>

  <!-- CURRENCY SCREEN -->
  <div class="screen" id="currencyScreen">
    <div class="currency-wrap">
      <!-- SEARCH -->
      <div class="searchWrap">
        <input class="search" id="search" placeholder="üîç Para birimi ara..." />
      </div>

      <!-- LIST (initially visible) -->
      <div id="listView" class="list"></div>

      <!-- CONVERTER (initially hidden) -->
      <div id="converterView" style="display:none;">
        <div class="pairBox">
          <div class="pairRow">
            <div class="pairLeft">
              <span class="flag" id="fromFlag">üáµüá±</span>
              <span id="fromCode">PLN</span>
            </div>
            <div class="bigNum" id="fromVal">0</div>
          </div>
          <div class="divider"></div>
          <div class="pairRow">
            <div class="pairLeft">
              <span class="flag" id="toFlag">üá¨üá™</span>
              <span id="toCode">GEL</span>
            </div>
            <div class="bigNum" id="toVal">0</div>
          </div>
        </div>

        <div class="keypad">
          <div class="k dark" data-action="clear2">C</div>
          <div class="k dark" data-action="back2">‚Üê</div>
          <div class="k dark" data-action="swap">‚Üë‚Üì</div>
          <div class="k dark" data-key2="%">%</div>

          <div class="k" data-key2="7">7</div>
          <div class="k" data-key2="8">8</div>
          <div class="k" data-key2="9">9</div>
          <div class="k op" data-op2="√∑">√∑</div>

          <div class="k" data-key2="4">4</div>
          <div class="k" data-key2="5">5</div>
          <div class="k" data-key2="6">6</div>
          <div class="k op" data-op2="√ó">√ó</div>

          <div class="k" data-key2="1">1</div>
          <div class="k" data-key2="2">2</div>
          <div class="k" data-key2="3">3</div>
          <div class="k op" data-op2="‚àí">‚àí</div>

          <div class="k wide" data-key2="0">0</div>
          <div class="k" data-key2=",">,</div>
          <div class="k op" data-op2="=">=</div>
        </div>

        <div class="bottomInfo">
          <div>
            <div class="stamp" id="stamp">--</div>
            <div class="rateLine" id="rateLine">1 PLN = -- GEL</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CHART SCREEN -->
  <div class="screen" id="chartScreen">
    <div class="chart-wrap">
      <div class="chart-box">
        <div class="chart-title">üìä D√∂viz Grafiƒüi PRO</div>
        <canvas id="chartCanvas"></canvas>
        <div class="chart-legend">
          <div class="legend-item">
            <div class="legend-color" style="background:linear-gradient(135deg, #667eea, #764ba2);"></div>
            <span>USD/TRY</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:linear-gradient(135deg, #f093fb, #f5576c);"></div>
            <span>EUR/TRY</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:linear-gradient(135deg, #4facfe, #00f2fe);"></div>
            <span>GBP/TRY</span>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ==================== CONFIG ==================== */
const API_KEY = "47c16e17e6-27770940e7-t9tidp";

const CURRENCIES = [
  { code:"PLN", name:"Polonya Zlotisi", flag:"üáµüá±" },
  { code:"USD", name:"ABD Dolarƒ±", flag:"üá∫üá∏" },
  { code:"TRY", name:"T√ºrk Lirasƒ±", flag:"üáπüá∑" },
  { code:"EUR", name:"Euro", flag:"üá™üá∫" },
  { code:"GEL", name:"G√ºrcistan Larisi", flag:"üá¨üá™" },
  { code:"CNY", name:"√áin Yuanƒ±", flag:"üá®üá≥" },
  { code:"RUB", name:"Rus Rublesi", flag:"üá∑üá∫" },
  { code:"GBP", name:"ƒ∞ngiliz Sterlini", flag:"üá¨üáß" },
  { code:"UAH", name:"Ukrayna Grivnasƒ±", flag:"üá∫üá¶" },
  { code:"CZK", name:"√áek Korunasƒ±", flag:"üá®üáø" },
  { code:"BYN", name:"Belarus Rublesi", flag:"üáßüáæ" },
  { code:"THB", name:"Tayland Bahtƒ±", flag:"üáπüá≠" },
  { code:"AZN", name:"Azerbaycan Manatƒ±", flag:"üá¶üáø" },
  { code:"JPY", name:"Japon Yeni", flag:"üáØüáµ" },
  { code:"CAD", name:"Kanada Dolarƒ±", flag:"üá®üá¶" },
  { code:"CHF", name:"ƒ∞svi√ßre Frangƒ±", flag:"üá®üá≠" }
];

/* ==================== STATE ==================== */
let currentTab = "tumbler";

// Tumbler state
let tumblerCategory = null;
let tumblerTime = null;
let tumblerChart = null;

// Calculator state
let calcExpr = "0";
let calcFirst = null;
let calcOp = null;
let calcWaitingSecond = false;

// Currency state
let from = "PLN";
let to = "GEL";
let currExpr = "0";
let currFirst = null;
let currOp = null;
let currWaitingSecond = false;
let currencyMode = "list"; // "list" or "converter"

/* ==================== DOM ELEMENTS ==================== */
const backBtn = document.getElementById("backBtn");
const topTitle = document.getElementById("topTitle");

const tumblerScreen = document.getElementById("tumblerScreen");
const calcScreen = document.getElementById("calcScreen");
const currencyScreen = document.getElementById("currencyScreen");
const chartScreen = document.getElementById("chartScreen");

const display = document.getElementById("display");
const subDisplay = document.getElementById("subDisplay");

const listView = document.getElementById("listView");
const converterView = document.getElementById("converterView");
const searchEl = document.getElementById("search");
const fromFlag = document.getElementById("fromFlag");
const toFlag = document.getElementById("toFlag");
const fromCode = document.getElementById("fromCode");
const toCode = document.getElementById("toCode");
const fromVal = document.getElementById("fromVal");
const toVal = document.getElementById("toVal");
const stampEl = document.getElementById("stamp");
const rateLineEl = document.getElementById("rateLine");

const chartCanvas = document.getElementById("chartCanvas");
let chartCtx = chartCanvas.getContext("2d");

/* ==================== TAB SWITCHING ==================== */
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    
    currentTab = tab.getAttribute("data-tab");
    
    tumblerScreen.classList.remove("active");
    calcScreen.classList.remove("active");
    currencyScreen.classList.remove("active");
    chartScreen.classList.remove("active");
    
    if(currentTab === "tumbler"){
      tumblerScreen.classList.add("active");
      backBtn.style.visibility = "hidden";
    } else if(currentTab === "calc"){
      calcScreen.classList.add("active");
      backBtn.style.visibility = "hidden";
    } else if(currentTab === "currency"){
      currencyScreen.classList.add("active");
      if(currencyMode === "converter"){
        backBtn.style.visibility = "visible";
      } else {
        backBtn.style.visibility = "hidden";
      }
    } else if(currentTab === "chart"){
      chartScreen.classList.add("active");
      backBtn.style.visibility = "hidden";
      drawChart();
    }
  });
});

backBtn.addEventListener("click", () => {
  if(currentTab === "currency" && currencyMode === "converter"){
    showCurrencyList();
  }
});

/* ==================== TUMBLER LOGIC ==================== */
document.querySelectorAll("[data-category]").forEach(item => {
  item.addEventListener("click", () => {
    document.querySelectorAll("[data-category]").forEach(i => i.classList.remove("selected"));
    item.classList.add("selected");
    tumblerCategory = item.getAttribute("data-category");
    updateTumblerSelection();
  });
});

document.querySelectorAll("[data-time]").forEach(item => {
  item.addEventListener("click", () => {
    document.querySelectorAll("[data-time]").forEach(i => i.classList.remove("selected"));
    item.classList.add("selected");
    tumblerTime = item.getAttribute("data-time");
    updateTumblerSelection();
  });
});

document.querySelectorAll("[data-chart]").forEach(item => {
  item.addEventListener("click", () => {
    document.querySelectorAll("[data-chart]").forEach(i => i.classList.remove("selected"));
    item.classList.add("selected");
    tumblerChart = item.getAttribute("data-chart");
    updateTumblerSelection();
  });
});

function updateTumblerSelection(){
  const sel = document.getElementById("tumblerSelection");
  const parts = [];
  if(tumblerCategory) parts.push(tumblerCategory.toUpperCase());
  if(tumblerTime) parts.push(tumblerTime);
  if(tumblerChart) parts.push(tumblerChart);
  sel.textContent = parts.length ? parts.join(" ‚Ä¢ ") : "Kategori ‚Ä¢ Zaman ‚Ä¢ Grafik";
}

document.getElementById("applyTumbler").addEventListener("click", () => {
  if(!tumblerCategory || !tumblerTime || !tumblerChart){
    alert("‚ö†Ô∏è L√ºtfen t√ºm se√ßimleri yapƒ±n!");
    return;
  }
  alert(`‚úÖ Uygulandƒ±!\nüìä ${tumblerCategory} ‚Ä¢ ${tumblerTime} ‚Ä¢ ${tumblerChart}`);
  // Burada grafik ekranƒ±na ge√ßi≈ü yapabilir veya API'ye istek atabilirsiniz
});

/* ==================== CALCULATOR LOGIC ==================== */
function normalizeNumber(s){
  return s.replace(",", ".");
}
function formatNumber(n){
  if(!isFinite(n)) return "0";
  const s = n.toString();
  if(s.includes(".")){
    const [a,b] = s.split(".");
    if(b.length > 6) return a + "," + b.slice(0,6);
    return s.replace(".", ",");
  }
  return s;
}

function calcPressKey(k){
  if(calcWaitingSecond){
    calcExpr = "0";
    calcWaitingSecond = false;
  }
  
  if(k === ","){
    if(!calcExpr.includes(",")) calcExpr += ",";
  } else {
    if(calcExpr === "0") calcExpr = k;
    else calcExpr += k;
  }
  updateCalcDisplay();
}

function calcClear(){
  calcExpr = "0";
  calcFirst = null;
  calcOp = null;
  calcWaitingSecond = false;
  subDisplay.textContent = "";
  updateCalcDisplay();
}

function calcSign(){
  const v = parseFloat(normalizeNumber(calcExpr)) || 0;
  calcExpr = formatNumber(-v);
  updateCalcDisplay();
}

function calcPercent(){
  const v = parseFloat(normalizeNumber(calcExpr)) || 0;
  calcExpr = formatNumber(v / 100);
  updateCalcDisplay();
}

function calcSetOp(newOp){
  const current = parseFloat(normalizeNumber(calcExpr)) || 0;
  
  if(calcFirst === null){
    calcFirst = current;
    calcOp = newOp;
    calcWaitingSecond = true;
    subDisplay.textContent = `${formatNumber(calcFirst)} ${newOp}`;
  } else if(calcOp && !calcWaitingSecond){
    calcFirst = calcCompute(calcFirst, current, calcOp);
    calcOp = newOp;
    calcExpr = formatNumber(calcFirst);
    calcWaitingSecond = true;
    subDisplay.textContent = `${formatNumber(calcFirst)} ${newOp}`;
    updateCalcDisplay();
  } else {
    calcOp = newOp;
    calcWaitingSecond = true;
    subDisplay.textContent = `${formatNumber(calcFirst)} ${newOp}`;
  }
}

function calcCompute(a, b, o){
  switch(o){
    case "+": return a + b;
    case "‚àí": return a - b;
    case "√ó": return a * b;
    case "√∑": return b === 0 ? 0 : a / b;
    default: return b;
  }
}

function calcEquals(){
  if(calcFirst === null || !calcOp) return;
  const current = parseFloat(normalizeNumber(calcExpr)) || 0;
  const res = calcCompute(calcFirst, current, calcOp);
  subDisplay.textContent = `${formatNumber(calcFirst)} ${calcOp} ${formatNumber(current)} =`;
  calcExpr = formatNumber(res);
  calcFirst = null;
  calcOp = null;
  calcWaitingSecond = false;
  updateCalcDisplay();
}

function updateCalcDisplay(){
  display.textContent = calcExpr;
}

document.addEventListener("click", (e) => {
  const key = e.target.getAttribute("data-key");
  const action = e.target.getAttribute("data-action");
  const op = e.target.getAttribute("data-op");
  
  if(currentTab === "calc"){
    if(key) calcPressKey(key);
    if(action === "clear") calcClear();
    if(action === "sign") calcSign();
    if(action === "percent") calcPercent();
    if(op){
      if(op === "=") calcEquals();
      else calcSetOp(op);
    }
  }
});

/* ==================== CURRENCY LOGIC ==================== */
function showCurrencyList(){
  currencyMode = "list";
  listView.style.display = "block";
  converterView.style.display = "none";
  backBtn.style.visibility = "hidden";
  renderCurrencyList("");
}

function showCurrencyConverter(){
  currencyMode = "converter";
  listView.style.display = "none";
  converterView.style.display = "block";
  backBtn.style.visibility = "visible";
  syncCurrencyUI();
  convertAndUpdate();
}

function renderCurrencyList(filter=""){
  listView.innerHTML = "";
  const f = filter.trim().toLowerCase();
  CURRENCIES
    .filter(x => !f || x.name.toLowerCase().includes(f) || x.code.toLowerCase().includes(f))
    .forEach(x => {
      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `
        <div class="left">
          <div class="flag">${x.flag}</div>
          <div class="name">${x.name}</div>
        </div>
        <div class="code">${x.code}</div>
      `;
      row.onclick = () => pickCurrency(x.code);
      listView.appendChild(row);
    });
}

let picking = "to";
function pickCurrency(code){
  if(picking === "from") from = code;
  else to = code;
  showCurrencyConverter();
}

searchEl.addEventListener("input", (e) => {
  if(currencyMode === "list"){
    renderCurrencyList(e.target.value);
  }
});

function syncCurrencyUI(){
  const f = CURRENCIES.find(x => x.code === from);
  const t = CURRENCIES.find(x => x.code === to);
  fromFlag.textContent = f?.flag || "üè≥Ô∏è";
  toFlag.textContent = t?.flag || "üè≥Ô∏è";
  fromCode.textContent = from;
  toCode.textContent = to;
}

async function fetchConvert(amount, fromC, toC){
  const url = `https://api.fastforex.io/convert?from=${fromC}&to=${toC}&amount=${amount}&api_key=${API_KEY}`;
  const res = await fetch(url);
  return await res.json();
}

async function convertAndUpdate(){
  const amount = parseFloat(normalizeNumber(currExpr)) || 0;
  fromVal.textContent = currExpr;
  
  try{
    toVal.textContent = "‚Ä¶";
    const data = await fetchConvert(amount, from, to);
    
    if(data?.result?.[to] != null){
      const out = data.result[to];
      toVal.textContent = out.toFixed(2).replace(".", ",");
      
      const baseAmount = amount === 0 ? 1 : amount;
      const baseData = amount === 0 ? data : await fetchConvert(1, from, to);
      const rate = baseData?.result?.[to];
      
      if(rate != null){
        rateLineEl.textContent = `1 ${from} = ${rate.toFixed(2).replace(".", ",")} ${to}`;
      } else {
        rateLineEl.textContent = `1 ${from} = -- ${to}`;
      }
      
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,"0");
      const mm = String(now.getMonth()+1).padStart(2,"0");
      const yyyy = now.getFullYear();
      const hh = String(now.getHours()).padStart(2,"0");
      const mi = String(now.getMinutes()).padStart(2,"0");
      stampEl.textContent = `${dd}.${mm}.${yyyy} ${hh}:${mi}`;
    } else {
      toVal.textContent = "0";
      rateLineEl.textContent = `1 ${from} = -- ${to}`;
    }
  } catch(e){
    toVal.textContent = "0";
    rateLineEl.textContent = `1 ${from} = -- ${to}`;
    console.error(e);
  }
}

function currPressKey(k){
  if(currWaitingSecond){
    currExpr = "0";
    currWaitingSecond = false;
  }
  
  if(k === "%"){
    const v = parseFloat(normalizeNumber(currExpr)) || 0;
    currExpr = formatNumber(v / 100);
    convertAndUpdate();
    return;
  }
  
  if(k === ","){
    if(!currExpr.includes(",")) currExpr += ",";
  } else {
    if(currExpr === "0") currExpr = k;
    else currExpr += k;
  }
  convertAndUpdate();
}

function currClear(){
  currExpr = "0";
  currFirst = null;
  currOp = null;
  currWaitingSecond = false;
  convertAndUpdate();
}

function currBackspace(){
  if(currWaitingSecond){
    currExpr = "0";
    currWaitingSecond = false;
  } else {
    if(currExpr.length <= 1) currExpr = "0";
    else currExpr = currExpr.slice(0, -1);
  }
  convertAndUpdate();
}

function currSetOp(newOp){
  const current = parseFloat(normalizeNumber(currExpr)) || 0;
  
  if(currFirst === null){
    currFirst = current;
    currOp = newOp;
    currWaitingSecond = true;
  } else if(currOp && !currWaitingSecond){
    currFirst = calcCompute(currFirst, current, currOp);
    currOp = newOp;
    currExpr = formatNumber(currFirst);
    currWaitingSecond = true;
    convertAndUpdate();
  } else {
    currOp = newOp;
    currWaitingSecond = true;
  }
}

function currEquals(){
  if(currFirst === null || !currOp) return;
  const current = parseFloat(normalizeNumber(currExpr)) || 0;
  const res = calcCompute(currFirst, current, currOp);
  currExpr = formatNumber(res);
  currFirst = null;
  currOp = null;
  currWaitingSecond = false;
  convertAndUpdate();
}

function swapPair(){
  [from, to] = [to, from];
  syncCurrencyUI();
  convertAndUpdate();
}

document.addEventListener("click", (e) => {
  const key2 = e.target.getAttribute("data-key2");
  const action = e.target.getAttribute("data-action");
  const op2 = e.target.getAttribute("data-op2");
  
  if(currentTab === "currency" && currencyMode === "converter"){
    if(key2) currPressKey(key2);
    if(action === "clear2") currClear();
    if(action === "back2") currBackspace();
    if(action === "swap") swapPair();
    if(op2){
      if(op2 === "=") currEquals();
      else currSetOp(op2);
    }
  }
});

/* ==================== CHART LOGIC ==================== */
function drawChart(){
  const width = chartCanvas.width = chartCanvas.offsetWidth * 2;
  const height = chartCanvas.height = 600;
  
  chartCtx.clearRect(0, 0, width, height);
  
  // Gradient background
  const bgGrad = chartCtx.createLinearGradient(0, 0, 0, height);
  bgGrad.addColorStop(0, "rgba(102,126,234,0.1)");
  bgGrad.addColorStop(1, "rgba(118,75,162,0.05)");
  chartCtx.fillStyle = bgGrad;
  chartCtx.fillRect(0, 0, width, height);
  
  // Sample data (7 g√ºnl√ºk)
  const labels = ["Pzt", "Sal", "√áar", "Per", "Cum", "Cmt", "Paz"];
  const data1 = [32.5, 33.1, 32.8, 33.4, 33.9, 33.6, 34.2]; // USD/TRY
  const data2 = [35.8, 36.2, 35.9, 36.5, 37.1, 36.8, 37.4]; // EUR/TRY
  const data3 = [41.2, 41.8, 41.5, 42.1, 42.7, 42.4, 43.0]; // GBP/TRY
  
  const padding = 80;
  const graphWidth = width - padding * 2;
  const graphHeight = height - padding * 2;
  
  // Grid
  chartCtx.strokeStyle = "rgba(255,255,255,0.1)";
  chartCtx.lineWidth = 2;
  for(let i = 0; i <= 5; i++){
    const y = padding + (graphHeight / 5) * i;
    chartCtx.beginPath();
    chartCtx.moveTo(padding, y);
    chartCtx.lineTo(width - padding, y);
    chartCtx.stroke();
  }
  
  // Draw line
  function drawLine(data, color){
    const step = graphWidth / (data.length - 1);
    const min = Math.min(...data, ...data1, ...data2, ...data3);
    const max = Math.max(...data, ...data1, ...data2, ...data3);
    const range = max - min || 1;
    
    chartCtx.strokeStyle = color;
    chartCtx.lineWidth = 6;
    chartCtx.lineJoin = "round";
    chartCtx.lineCap = "round";
    chartCtx.beginPath();
    
    data.forEach((val, i) => {
      const x = padding + step * i;
      const y = padding + graphHeight - ((val - min) / range) * graphHeight;
      if(i === 0) chartCtx.moveTo(x, y);
      else chartCtx.lineTo(x, y);
    });
    chartCtx.stroke();
    
    // Gradient fill
    const grad = chartCtx.createLinearGradient(0, padding, 0, height - padding);
    grad.addColorStop(0, color.replace("1)", "0.3)"));
    grad.addColorStop(1, color.replace("1)", "0)"));
    chartCtx.lineTo(width - padding, height - padding);
    chartCtx.lineTo(padding, height - padding);
    chartCtx.closePath();
    chartCtx.fillStyle = grad;
    chartCtx.fill();
  }
  
  drawLine(data1, "rgba(102,126,234,1)");
  drawLine(data2, "rgba(245,87,108,1)");
  drawLine(data3, "rgba(0,242,254,1)");
  
  // Labels
  chartCtx.fillStyle = "rgba(255,255,255,0.6)";
  chartCtx.font = "24px system-ui";
  chartCtx.textAlign = "center";
  labels.forEach((label, i) => {
    const x = padding + (graphWidth / (labels.length - 1)) * i;
    chartCtx.fillText(label, x, height - padding + 40);
  });
}

/* ==================== INIT ==================== */
function init(){
  renderCurrencyList("");
  updateCalcDisplay();
}
init();
</script>
</body>
</html>
